!function(){function createXHR(){try{return new window.XMLHttpRequest}catch(a){try{return new window.ActiveXObject("Msxml2.XMLHTTP")}catch(a){return new window.ActiveXObject("Microsoft.XMLHTTP")}}}function now(){return(new Date).getTime()}function sign(a,b){var c=[],d=[];for(var e in b)c.push(e);c.sort();for(var f=0;f<c.length;++f){var e=c[f];d.push(e+"="+b[e])}return b.signature=md5(baseUrlForSignature+a+d.join("&")).toUpperCase(),b}function Promise(){var a=this,b=!1,c=!1;this.ok=function(c){return a.honor=c,b&&a.honor(),a},this.fail=function(b){return a.refuse=b,c&&a.refuse(),a},this.honor=function(){b=!0},this.refuse=function(){c=!0}}function request(a,b,c,d,e){var f=new Promise,g=[];for(var h in c)g.push(h+"="+c[h]);var i=createXHR();if(i.onreadystatechange=function(){4==i.readyState&&(200==i.status?f.honor(i):f.refuse(i))},"POST"==b)if(d){var j;j=c?baseUrl+a+"?"+g.join("&"):baseUrl+a,i.open("POST",j),i.setRequestHeader("Content-type",e),i.send(d)}else i.open("POST",baseUrl+a),i.setRequestHeader("Content-type","application/x-www-form-urlencoded"),i.send(g.join("&"));else i.open("GET",baseUrl+a+"?"+g.join("&")),i.send();return f}function checkAccessToken(){var a=new Promise;return!accessToken||now()>accessTokenExpireTime?request("/token","POST",{op:"grant",appid:appId,secret:appSecret}).ok(function(b){var c=window.JSON.parse(b.responseText);accessToken=c.data.access_token,accessTokenExpireTime=now()+1e3*c.data.expires_in-6e5,a.honor()}).fail(function(){a.refuse()}):a.honor(),a}function getStandardParams(){return{access_token:accessToken,timestamp:now(),device_no:"web",os:"web",app_uid:"me",sdk_version:"1.0.0",ssl_res:!0}}function getImageUrl(a){var b=new Promise;return checkAccessToken().ok(function(){var c="/emoji/code/"+a;request(c,"GET",sign(c,getStandardParams())).ok(function(a){var c=window.JSON.parse(a.responseText);0===c.error_code?b.honor(c.data.main_image):b.refuse(c)}).fail(function(a){b.refuse(a.responseText)})}),b}function getImageUrls(a){var b=new Promise;return checkAccessToken().ok(function(){var c="/emoji/codes",d=JSON.stringify({codes:a});request(c,"POST",sign(c,getStandardParams()),d,"application/json").ok(function(a){var c=window.JSON.parse(a.responseText);0===c.error_code?b.honor(c.data_list):b.refuse(c)}).fail(function(a){b.refuse(a)})}),b}document.createElement("bqmm-emoji"),window.JSON||(window.JSON={parse:function(sJSON){return eval("("+sJSON+")")},stringify:function(){var a=Object.prototype.toString,b=Array.isArray||function(b){return"[object Array]"===a.call(b)},c={'"':'\\"',"\\":"\\\\","\b":"\\b","\f":"\\f","\n":"\\n","\r":"\\r","\t":"\\t"},d=function(a){return c[a]||"\\u"+(a.charCodeAt(0)+65536).toString(16).substr(1)},e=/[\\"\u0000-\u001F\u2028\u2029]/g;return function c(f){if(null==f)return"null";if("number"==typeof f)return isFinite(f)?f.toString():"null";if("boolean"==typeof f)return f.toString();if("object"==typeof f){if("function"==typeof f.toJSON)return c(f.toJSON());if(b(f)){for(var g="[",h=0;h<f.length;h++)g+=(h?", ":"")+c(f[h]);return g+"]"}if("[object Object]"===a.call(f)){var i=[];for(var j in f)f.hasOwnProperty(j)&&i.push(c(j)+": "+c(f[j]));return"{"+i.join(", ")+"}"}}return'"'+f.toString().replace(e,d)+'"'}}()});var md5=function(){var a=function(a,b){var g=a[0],h=a[1],i=a[2],j=a[3];g=c(g,h,i,j,b[0],7,-680876936),j=c(j,g,h,i,b[1],12,-389564586),i=c(i,j,g,h,b[2],17,606105819),h=c(h,i,j,g,b[3],22,-1044525330),g=c(g,h,i,j,b[4],7,-176418897),j=c(j,g,h,i,b[5],12,1200080426),i=c(i,j,g,h,b[6],17,-1473231341),h=c(h,i,j,g,b[7],22,-45705983),g=c(g,h,i,j,b[8],7,1770035416),j=c(j,g,h,i,b[9],12,-1958414417),i=c(i,j,g,h,b[10],17,-42063),h=c(h,i,j,g,b[11],22,-1990404162),g=c(g,h,i,j,b[12],7,1804603682),j=c(j,g,h,i,b[13],12,-40341101),i=c(i,j,g,h,b[14],17,-1502002290),h=c(h,i,j,g,b[15],22,1236535329),g=d(g,h,i,j,b[1],5,-165796510),j=d(j,g,h,i,b[6],9,-1069501632),i=d(i,j,g,h,b[11],14,643717713),h=d(h,i,j,g,b[0],20,-373897302),g=d(g,h,i,j,b[5],5,-701558691),j=d(j,g,h,i,b[10],9,38016083),i=d(i,j,g,h,b[15],14,-660478335),h=d(h,i,j,g,b[4],20,-405537848),g=d(g,h,i,j,b[9],5,568446438),j=d(j,g,h,i,b[14],9,-1019803690),i=d(i,j,g,h,b[3],14,-187363961),h=d(h,i,j,g,b[8],20,1163531501),g=d(g,h,i,j,b[13],5,-1444681467),j=d(j,g,h,i,b[2],9,-51403784),i=d(i,j,g,h,b[7],14,1735328473),h=d(h,i,j,g,b[12],20,-1926607734),g=e(g,h,i,j,b[5],4,-378558),j=e(j,g,h,i,b[8],11,-2022574463),i=e(i,j,g,h,b[11],16,1839030562),h=e(h,i,j,g,b[14],23,-35309556),g=e(g,h,i,j,b[1],4,-1530992060),j=e(j,g,h,i,b[4],11,1272893353),i=e(i,j,g,h,b[7],16,-155497632),h=e(h,i,j,g,b[10],23,-1094730640),g=e(g,h,i,j,b[13],4,681279174),j=e(j,g,h,i,b[0],11,-358537222),i=e(i,j,g,h,b[3],16,-722521979),h=e(h,i,j,g,b[6],23,76029189),g=e(g,h,i,j,b[9],4,-640364487),j=e(j,g,h,i,b[12],11,-421815835),i=e(i,j,g,h,b[15],16,530742520),h=e(h,i,j,g,b[2],23,-995338651),g=f(g,h,i,j,b[0],6,-198630844),j=f(j,g,h,i,b[7],10,1126891415),i=f(i,j,g,h,b[14],15,-1416354905),h=f(h,i,j,g,b[5],21,-57434055),g=f(g,h,i,j,b[12],6,1700485571),j=f(j,g,h,i,b[3],10,-1894986606),i=f(i,j,g,h,b[10],15,-1051523),h=f(h,i,j,g,b[1],21,-2054922799),g=f(g,h,i,j,b[8],6,1873313359),j=f(j,g,h,i,b[15],10,-30611744),i=f(i,j,g,h,b[6],15,-1560198380),h=f(h,i,j,g,b[13],21,1309151649),g=f(g,h,i,j,b[4],6,-145523070),j=f(j,g,h,i,b[11],10,-1120210379),i=f(i,j,g,h,b[2],15,718787259),h=f(h,i,j,g,b[9],21,-343485551),a[0]=m(g,a[0]),a[1]=m(h,a[1]),a[2]=m(i,a[2]),a[3]=m(j,a[3])},b=function(a,b,c,d,e,f){return b=m(m(b,a),m(d,f)),m(b<<e|b>>>32-e,c)},c=function(a,c,d,e,f,g,h){return b(c&d|~c&e,a,c,f,g,h)},d=function(a,c,d,e,f,g,h){return b(c&e|d&~e,a,c,f,g,h)},e=function(a,c,d,e,f,g,h){return b(c^d^e,a,c,f,g,h)},f=function(a,c,d,e,f,g,h){return b(d^(c|~e),a,c,f,g,h)},g=function(b){var f,d=b.length,e=[1732584193,-271733879,-1732584194,271733878];for(f=64;f<=b.length;f+=64)a(e,h(b.substring(f-64,f)));b=b.substring(f-64);var g=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];for(f=0;f<b.length;f++)g[f>>2]|=b.charCodeAt(f)<<(f%4<<3);if(g[f>>2]|=128<<(f%4<<3),f>55)for(a(e,g),f=0;f<16;f++)g[f]=0;return g[14]=8*d,a(e,g),e},h=function(a){var c,b=[];for(c=0;c<64;c+=4)b[c>>2]=a.charCodeAt(c)+(a.charCodeAt(c+1)<<8)+(a.charCodeAt(c+2)<<16)+(a.charCodeAt(c+3)<<24);return b},i="0123456789abcdef".split(""),j=function(a){for(var b="",c=0;c<4;c++)b+=i[a>>8*c+4&15]+i[a>>8*c&15];return b},k=function(a){for(var b=0;b<a.length;b++)a[b]=j(a[b]);return a.join("")},l=function(a){return k(g(a))},m=function(a,b){return a+b&4294967295};return"5d41402abc4b2a76b9719d911017c592"!=l("hello")&&(m=function(a,b){var c=(65535&a)+(65535&b),d=(a>>16)+(b>>16)+(c>>16);return d<<16|65535&c}),l}();BQMM={};var defaultImg="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQI12NgAAIAAAUAAeImBZsAAAAASUVORK5CYII=",baseUrl="https://sop.biaoqingmm.com:1443/api/v1",baseUrlForSignature="http://sop.biaoqingmm.com:1443/api/v1",appId,appSecret,accessToken,accessTokenExpireTime;BQMM.messageCodec={decode:function(a){for(var b=a.split(/\[([12]),(\w+)\]/),c=[],d=0;d<b.length;d+=3)b[d].length&&c.push([b[d],0]),b[d+1]&&c.push([b[d+2],b[d+1]]);return c}},BQMM.renderDOMMessage=function(){var a=document.querySelectorAll("bqmm-emoji");if(a&&a.length){for(var b=[],c=0;c<a.length;++c){var d=a[c],e=d.getAttribute("code"),f=d.getAttribute("type");if(e&&f){b.push(e);var g=document.createElement("img");g.setAttribute("src",defaultImg),g.setAttribute("code",e),1==parseInt(f)?g.setAttribute("style","display:inline-block;width:1.5em;height:1.5em"):g.setAttribute("style","display:inline-block;width:5em;height:5em"),d.parentNode.replaceChild(g,d)}}getImageUrls(b).ok(function(a){for(var b=0;b<a.length;++b)for(var c=a[b],d=document.querySelectorAll("img[code="+c.emo_code+"]"),e=0;e<d.length;++e)d[e].style.background="url("+c.main_image+") center/100%"}).fail(function(a){console.log(a)})}},BQMM.init=function(a,b,c){appId=a,appSecret=b,c&&(BQMM.messageCodec=c),BQMM.renderDOMMessage()},BQMM.renderMessage=function(a){for(var b=BQMM.messageCodec.decode(a),c=[],d="",e=0;e<b.length;++e){var f=parseInt(b[e][1]);f?(c.push(b[e][0]),1==f?d+='<img src="'+defaultImg+'" code="'+b[e][0]+'" style="display:inline-block;border:none;width:1.5em;height:1.5em"/>':2==f&&(d+='<img src="'+defaultImg+'" code="'+b[e][0]+'" style="display:inline-block;width:5em;height:5em"/>')):d+=b[e][0]}return getImageUrls(c).ok(function(a){for(var b=0;b<a.length;++b)for(var c=a[b],d=document.querySelectorAll("img[code="+c.emo_code+"]"),e=0;e<d.length;++e)d[e].style.background="url("+c.main_image+") center/100%"}).fail(function(a){console.log(a)}),d}}();